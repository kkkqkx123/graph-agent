# Session Repository æ¶æ„å¯¹æ¯”åˆ†æ

## æ¦‚è¿°

æœ¬æ–‡æ¡£å¯¹æ¯”åˆ†æä¸‰ç§ä¸åŒçš„Session Repositoryå®ç°æ–¹æ¡ˆï¼Œå±•ç¤ºä»ä¼ ç»Ÿmapperåˆ°ç±»å‹è½¬æ¢å™¨çš„æ¼”è¿›è¿‡ç¨‹ã€‚

## æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1ï¼šä¼ ç»ŸMapperï¼ˆå½“å‰å®ç°ï¼‰

**æ–‡ä»¶**ï¼š`session-mapper.ts`ï¼ˆå·²ä¼˜åŒ–ç‰ˆæœ¬ï¼‰

**ç‰¹ç‚¹**ï¼š
- âœ… è¿è¡Œæ—¶éªŒè¯
- âœ… é”™è¯¯å¤„ç†
- âœ… ä¸šåŠ¡è§„åˆ™éªŒè¯
- âŒ ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥æœ‰é™
- âŒ æ˜ å°„é€»è¾‘åˆ†æ•£

**æ ¸å¿ƒä»£ç **ï¼š
```typescript
export class SessionMapper implements IMapper<Session, SessionModel> {
  toEntity(model: SessionModel): Session {
    // è¿è¡Œæ—¶éªŒè¯
    this.validateModel(model);
    
    // æ‰‹åŠ¨ç±»å‹è½¬æ¢
    const props: SessionData = {
      id: ID.fromString(model.id),
      userId: model.userId ? ID.fromString(model.userId) : undefined,
      // ... å…¶ä»–å­—æ®µ
    };
    
    return Session.fromProps(props);
  }
}
```

### æ–¹æ¡ˆ2ï¼šé™æ€ç±»å‹Mapperï¼ˆè¿‡åº¦è®¾è®¡ï¼‰

**æ–‡ä»¶**ï¼š`session-static-mapper.ts`

**ç‰¹ç‚¹**ï¼š
- âœ… ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
- âœ… ç±»å‹è½¬æ¢å™¨å¤ç”¨
- âœ… æ˜ å°„å®šä¹‰æ¸…æ™°
- âŒ æ¶æ„å¤æ‚
- âŒ è¿‡åº¦æŠ½è±¡

**æ ¸å¿ƒä»£ç **ï¼š
```typescript
export class SessionStaticMapper implements IMapper<Session, SessionModel> {
  private readonly typeMapper: StaticTypeMapper<SessionModel, SessionData>;
  
  constructor() {
    this.typeMapper = createStaticTypeMapper({
      id: {
        storageField: 'id',
        converter: IdConverter,
        required: true
      },
      // ... å…¶ä»–å­—æ®µæ˜ å°„
    });
  }
}
```

### æ–¹æ¡ˆ3ï¼šè½¬æ¢å™¨ç›´æ¥é›†æˆï¼ˆæ¨èï¼‰

**æ–‡ä»¶**ï¼š`session-converter-repository.ts`

**ç‰¹ç‚¹**ï¼š
- âœ… ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
- âœ… æ¶æ„ç®€æ´
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… æ˜“äºç»´æŠ¤
- âœ… ç›´æ¥é›†æˆ

**æ ¸å¿ƒä»£ç **ï¼š
```typescript
export class SessionConverterRepository extends BaseRepository<Session, SessionModel, ID> {
  
  protected override toEntity(model: SessionModel): Session {
    // ç›´æ¥ä½¿ç”¨ç±»å‹è½¬æ¢å™¨
    const sessionData = {
      id: IdConverter.fromStorage(model.id),
      userId: model.userId ? OptionalIdConverter.fromStorage(model.userId) : undefined,
      status: SessionStatusConverter.fromStorage(model.state),
      // ... å…¶ä»–å­—æ®µ
    };
    
    return Session.fromProps(sessionData);
  }
}
```

## æ¶æ„å¯¹æ¯”åˆ†æ

### 1. ç±»å‹å®‰å…¨æ€§

| æ–¹æ¡ˆ | ç¼–è¯‘æ—¶æ£€æŸ¥ | è¿è¡Œæ—¶éªŒè¯ | ç±»å‹çº¦æŸ |
|------|------------|------------|----------|
| ä¼ ç»ŸMapper | âŒ æœ‰é™ | âœ… å®Œæ•´ | âŒ å¼± |
| é™æ€Mapper | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å¼º |
| è½¬æ¢å™¨é›†æˆ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… å¼º |

### 2. æ¶æ„å¤æ‚åº¦

| æ–¹æ¡ˆ | æ–‡ä»¶æ•°é‡ | æŠ½è±¡å±‚çº§ | ç»´æŠ¤éš¾åº¦ |
|------|----------|----------|----------|
| ä¼ ç»ŸMapper | 2ä¸ªæ–‡ä»¶ | 2å±‚ | ä¸­ç­‰ |
| é™æ€Mapper | 4ä¸ªæ–‡ä»¶ | 4å±‚ | é«˜ |
| è½¬æ¢å™¨é›†æˆ | 2ä¸ªæ–‡ä»¶ | 1å±‚ | ä½ |

### 3. æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | è°ƒç”¨å±‚çº§ | å†…å­˜åˆ†é… | æ‰§è¡Œæ•ˆç‡ |
|------|----------|----------|----------|
| ä¼ ç»ŸMapper | 3å±‚è°ƒç”¨ | ä¸­ç­‰ | ä¸­ç­‰ |
| é™æ€Mapper | 5å±‚è°ƒç”¨ | é«˜ | ä½ |
| è½¬æ¢å™¨é›†æˆ | 2å±‚è°ƒç”¨ | ä½ | é«˜ |

### 4. ä»£ç è´¨é‡

| æ–¹æ¡ˆ | ä»£ç é‡å¤ | æµ‹è¯•å¤æ‚åº¦ | æ–‡æ¡£æ¸…æ™°åº¦ |
|------|----------|------------|------------|
| ä¼ ç»ŸMapper | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­ç­‰ |
| é™æ€Mapper | ä½ | é«˜ | é«˜ |
| è½¬æ¢å™¨é›†æˆ | ä½ | ä½ | é«˜ |

## æ¨èæ–¹æ¡ˆ

### ğŸ† æœ€ä½³é€‰æ‹©ï¼šè½¬æ¢å™¨ç›´æ¥é›†æˆ

**ç†ç”±**ï¼š
1. **æ¶æ„ç®€æ´**ï¼šæ¶ˆé™¤äº†ä¸å¿…è¦çš„æŠ½è±¡å±‚
2. **æ€§èƒ½ä¼˜ç§€**ï¼šå‡å°‘äº†è°ƒç”¨å±‚çº§å’Œå†…å­˜åˆ†é…
3. **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ + è¿è¡Œæ—¶éªŒè¯
4. **æ˜“äºç»´æŠ¤**ï¼šé€»è¾‘æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
5. **å¯æµ‹è¯•æ€§**ï¼šè½¬æ¢å™¨å¯ä»¥ç‹¬ç«‹æµ‹è¯•

### å®æ–½å»ºè®®

1. **ä¿ç•™ç±»å‹è½¬æ¢å™¨** (`session-type-converters.ts`)
   - æä¾›ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
   - å¯å¤ç”¨çš„è½¬æ¢é€»è¾‘
   - ç‹¬ç«‹çš„æµ‹è¯•å•å…ƒ

2. **æ”¹é€ Repository** (`session-converter-repository.ts`)
   - ç›´æ¥ä½¿ç”¨è½¬æ¢å™¨
   - é‡å†™`toEntity`å’Œ`toModel`æ–¹æ³•
   - ä¿æŒä¸BaseRepositoryçš„å…¼å®¹æ€§

3. **åºŸå¼ƒä¼ ç»ŸMapper** (`session-mapper.ts`)
   - é€æ­¥è¿ç§»åˆ°è½¬æ¢å™¨æ–¹æ¡ˆ
   - ä¿æŒå‘åå…¼å®¹æ€§
   - æœ€ç»ˆåˆ é™¤mapperæ–‡ä»¶

## è¿ç§»è·¯å¾„

### é˜¶æ®µ1ï¼šå¹¶è¡Œæ”¯æŒ
- ä¿ç•™ä¼ ç»Ÿmapper
- å®ç°è½¬æ¢å™¨repository
- æä¾›åˆ‡æ¢é…ç½®

### é˜¶æ®µ2ï¼šé€æ­¥è¿ç§»
- æ–°åŠŸèƒ½ä½¿ç”¨è½¬æ¢å™¨
- æ—§åŠŸèƒ½é€æ­¥è¿ç§»
- æ€§èƒ½å¯¹æ¯”æµ‹è¯•

### é˜¶æ®µ3ï¼šå®Œå…¨æ›¿æ¢
- åˆ é™¤ä¼ ç»Ÿmapper
- ç»Ÿä¸€ä½¿ç”¨è½¬æ¢å™¨
- æ¸…ç†åºŸå¼ƒä»£ç 

## ç»“è®º

**è½¬æ¢å™¨ç›´æ¥é›†æˆæ–¹æ¡ˆ**æ˜¯æœ€ä½³é€‰æ‹©ï¼Œå®ƒï¼š

- âœ… è§£å†³äº†ç±»å‹çº¦æŸé—®é¢˜
- âœ… ä¿æŒäº†æ¶æ„ç®€æ´
- âœ… æä¾›äº†ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨
- âœ… ä¼˜åŒ–äº†æ€§èƒ½
- âœ… ç®€åŒ–äº†ç»´æŠ¤

è¿™ä¸ªæ–¹æ¡ˆä»£è¡¨äº†ä»**è¿‡åº¦è®¾è®¡**åˆ°**æ°åˆ°å¥½å¤„**çš„æ¼”è¿›ï¼Œä½“ç°äº†"**ç®€å•å³ç¾**"çš„è®¾è®¡å“²å­¦ã€‚