当前提示词消息数组管理存在问题，没有区分用户消息、系统消息、llm消息，导致管理不方便。分析是否应该创建单独数组，顺序记录各个消息的索引

当前llm节点缺乏把llm输出作为用户输入的方式。例如有时候使用llm节点检查某个问题，我可能需要让该输出在后续以用户消息的形式存在。可以为llm节点新增把消息由llm消息(助手消息)转换为用户消息的选项。

当前triggered子工作流的回传参数中提示词消息仅支持是否回传。需要改进为支持多种操作，改为一个新的接口，支持最后几条消息、最后几条llm消息等。


triggered子工作流的检查点管理可能多余。分析是否应该改为仅在开始、结束时创建检查点，对triggered子工作流内部逻辑不再创建检查点，以避免此类临时工作流的执行状态需要保留


上下文操作节点、triggered subworkflow、thread合并都涉及提示词消息数组的修改。分析是否应该把提示词消息数组的操作作为独立工具类，仅提供方法导出，传入提示词数组，返回新的提示词数组(基于索引的操作)。


---

我指的检查点不是为了保证消息数组的稳定性，而是为了减少相关操作的开销。
你之前在node type中的ContextProcessorNodeConfig设计的createNewBatch需要彻底删除，因为消息数组自身的逻辑必须保证不会丢失任何信息。此外，我的想法是把消息的管理从llm分离出来，把所有可用操作(例如ContextProcessorNodeConfig的操作类型)也一起放在单独的类型定义中，保证绝对的统一来源。这里类型定义仅音乐

关于操作类型：对于插入，可以考虑不再支持-1，始终为中间插入，尾插专门由append类型来实现。append不需要开始新批次，其他则始终需要开始新批次。
其中clear实际上不会引入额外的数组元素拷贝开销，而其他操作实际上都会引入大量开销(因为需要把旧的批次的内容拷贝为新的批次)。

由于消息数组直接操作检查点管理显然是有问题的，可以考虑另一个思路：
在类型定义(新的单独类型定义)中添加批次快照数组。对于clear，快照为空，因为没有额外拷贝开销；对于其他操作(除append根本不需要新批次)，直接把消息数组深拷贝为快照，这样不再需要维护过度延长的数组(否则不仅需要拷贝元素，还会大幅延长数组)

工具提示词如何处理(需要使用context7 mcp，或参考anthropic sdk)

---

分析如何实现主线程运行时新建线程并接收回调的逻辑。例如主线程为主循环工作流，在执行过程中由用户/llm通过工具创建基于其他工作流的子线程，并把执行结果回调给主线程

动态新增工具使用新的add_tool节点，从llm节点分离出来
