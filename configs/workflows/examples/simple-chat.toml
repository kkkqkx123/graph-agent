# 简单对话工作流示例
# 展示如何使用默认配置系统简化工作流配置
# 这是一个业务工作流，必须包含 start 和 end 节点

[workflow]
id = "simple_chat"
name = "简单对话"
description = "使用默认配置的简单对话工作流"
version = "1.0.0"

# 定义工作流参数
# 这些参数会与 defaults.toml 中的默认值合并
[workflow.parameters]
# 提示词是必需参数，其他参数使用默认值
[workflow.parameters.prompt]
type = "string"
required = true
description = "用户输入的对话内容"

# 可选参数，如果不提供则使用默认值
[workflow.parameters.system_prompt]
type = "string"
default = ""
description = "系统提示词（可选）"

# 定义工作流节点
[[workflow.nodes]]
id = "start"
type = "start"
name = "开始"

[workflow.nodes.config]
# 初始化变量
initialVariables = { prompt = "{{parameters.prompt}}" }

[[workflow.nodes]]
id = "llm_node"
type = "llm"
name = "LLM对话"

# 节点配置 - 使用参数引用
[workflow.nodes.config]
# wrapper 配置使用默认值（来自 defaults.toml）
# 如果调用时传入了 wrapper_type 等参数，会覆盖默认值
wrapper_type = "{{parameters.wrapper_type}}"
wrapper_name = "{{parameters.wrapper_name}}"
wrapper_provider = "{{parameters.wrapper_provider}}"
wrapper_model = "{{parameters.wrapper_model}}"

# 提示词配置
[workflow.nodes.config.prompt]
type = "direct"
content = "{{parameters.prompt}}"

[workflow.nodes.config.system_prompt]
type = "direct"
content = "{{parameters.system_prompt}}"

# 温度和最大令牌数使用默认值
temperature = "{{parameters.temperature}}"
max_tokens = "{{parameters.max_tokens}}"

[[workflow.nodes]]
id = "end"
type = "end"
name = "结束"

[workflow.nodes.config]
# 收集执行结果
collectResults = true
# 清理临时资源
cleanupResources = true
# 返回的变量列表
returnVariables = ["llm_response"]

# 定义边连接
[[workflow.edges]]
from = "start"
to = "llm_node"

[[workflow.edges]]
from = "llm_node"
to = "end"

# ============================================================================
# 使用说明
# ============================================================================
#
# 1. 使用全局默认配置（最简单）
#    const workflow = await workflowManagement.loadWorkflow('simple_chat', {
#      prompt: "你好，请介绍一下自己"
#    });
#    # 实际使用：wrapper_type="pool", wrapper_name="default_pool", 
#    #          wrapper_provider="openai", wrapper_model="gpt-4o-mini"
#
# 2. 覆盖部分参数
#    const workflow = await workflowManagement.loadWorkflow('simple_chat', {
#      prompt: "你好",
#      wrapper_type: "direct",
#      wrapper_provider: "gemini",
#      wrapper_model: "gemini-2.5-pro"
#    });
#    # 实际使用：wrapper_type="direct", wrapper_provider="gemini",
#    #          wrapper_model="gemini-2.5-pro", temperature=0.7（默认值）
#
# 3. 使用预设场景
#    const workflow = await workflowManagement.loadWorkflow('simple_chat', {
#      prompt: "快速回答",
#      preset: "fast"
#    });
#    # 实际使用：wrapper_type="direct", wrapper_model="gpt-4o-mini", temperature=0.5
#
# 4. 完整自定义
#    const workflow = await workflowManagement.loadWorkflow('simple_chat', {
#      prompt: "详细分析",
#      wrapper_type: "direct",
#      wrapper_provider: "openai",
#      wrapper_model: "gpt-4o",
#      temperature: 0.8,
#      max_tokens: 4096
#    });
#    # 所有参数都使用传入的值
#
# ============================================================================