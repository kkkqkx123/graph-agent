# LLM调用基础子工作流
# 封装LLM调用+工具执行的基础操作
# 这是一个无状态的子工作流，可以被其他工作流引用

[workflow]
id = "base_llm_call"
name = "LLM调用基础操作"
description = "封装LLM调用和工具执行的基础操作"
version = "1.0.0"
type = "base"

# 可配置参数（用于在具体工作流中通过参数修改内部逻辑）
[workflow.parameters.wrapper_type]
type = "string"
default = "pool"
description = "Wrapper类型：pool | group | direct"

[workflow.parameters.wrapper_name]
type = "string"
default = "default_pool"
description = "Wrapper名称（pool或group类型）"

[workflow.parameters.wrapper_provider]
type = "string"
description = "提供商名称（direct类型）"

[workflow.parameters.wrapper_model]
type = "string"
description = "模型名称（direct类型）"

[workflow.parameters.prompt]
type = "string"
required = true
description = "LLM提示词"

[workflow.parameters.system_prompt]
type = "string"
default = ""
description = "系统提示词"

[workflow.parameters.tool_timeout]
type = "number"
default = 30000
description = "工具执行超时时间（毫秒）"

# 定义工作流节点
[[workflow.nodes]]
id = "llm_node"
type = "llm"
name = "LLM调用"

[workflow.nodes.config]
# LLM包装器配置（结构化对象）
# 根据wrapper_type动态构建wrapper对象
wrapper_type = "{{parameters.wrapper_type}}"
wrapper_name = "{{parameters.wrapper_name}}"
wrapper_provider = "{{parameters.wrapper_provider}}"
wrapper_model = "{{parameters.wrapper_model}}"

# 提示词配置
[workflow.nodes.config.prompt]
type = "direct"
content = "{{parameters.prompt}}"

[workflow.nodes.config.system_prompt]
type = "direct"
content = "{{parameters.system_prompt}}"

[[workflow.nodes]]
id = "check_tool_calls"
type = "condition"
name = "检查工具调用"

[workflow.nodes.config]
condition_type = "tool_calls_check"

[[workflow.nodes]]
id = "tool_executor"
type = "tool"
name = "工具执行器"

[workflow.nodes.config]
# 工具名称和参数从LLM响应中自动提取
tool_name = "auto"
tool_parameters = "auto"
timeout = "{{parameters.tool_timeout}}"

# 定义边连接
[[workflow.edges]]
from = "llm_node"
to = "check_tool_calls"

[[workflow.edges]]
from = "check_tool_calls"
to = "tool_executor"
condition = "has_tool_calls"
