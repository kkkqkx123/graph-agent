# 全局配置
log_level = "DEBUG"
env = "development"
debug = true
env_prefix = "AGENT_"

# 热重载配置
hot_reload = true
watch_interval = 5  # 5秒

# 日志输出配置
[[log_outputs]]
type = "console"
level = "DEBUG"
format = "text"

[[log_outputs]]
type = "file"
level = "DEBUG"
format = "json"
path = "logs/agent.log"
rotation = "daily"
max_size = "10MB"

# 秘密模式
secret_patterns = [
  "sk-[a-zA-Z0-9]{20,}",
  "ms-[a-zA-Z0-9]{15,}",
  "\\w+@\\w+\\.\\w+",
  "1\\d{10}"
]

# Checkpoint配置
[checkpoint]
enabled = true
storage_type = "sqlite"
auto_save = true
save_interval = 5
max_checkpoints = 100
retention_days = 30
db_path = "storage/checkpoints.db"
compression = false

# Checkpoint触发条件
[checkpoint.trigger_conditions]
events = [
  "tool_call",
  "state_change"
]

# LLM全局配置
[llm]
default_timeout = 30
default_max_retries = 3
default_provider = "openai"

# Gemini配置
[llm.gemini]
clientType = "native"  # 可选值: "native" 或 "openai-compatible"
apiKey = "${GEMINI_API_KEY}"
default_model = "gemini-2.5-flash"

# Gemini OpenAI兼容配置
[llm.gemini-openai]
apiKey = "${GEMINI_API_KEY}"
default_model = "gemini-2.5-flash"

# 全局重试配置
[llm.retry_config]
base_delay = 1.0
max_delay = 60.0
jitter = true
exponential_base = 2.0
retry_on_status_codes = [429, 500, 502, 503, 504]

# 需要重试的错误类型
[llm.retry_config.retry_errors]
types = [
  "timeout",
  "rate_limit",
  "service_unavailable"
]

# 全局超时配置
[llm.timeout_config]
request_timeout = 60
connect_timeout = 10
read_timeout = 45
write_timeout = 15

# 性能优化配置
[llm.performance]
max_concurrent_requests = 10
request_queue_size = 100
connection_pool_size = 20
connection_keep_alive = true

# 工作流引擎配置
[workflow]
# 默认执行超时时间（毫秒）
default_timeout = 300000
# 默认最大执行步数
default_max_steps = 1000
# 默认检查点间隔（节点数）
default_checkpoint_interval = 5
# 默认是否启用检查点
default_enable_checkpoints = true

# 状态管理器配置
[workflow.state_manager]
# 最大缓存状态数量
max_cache_size = 1000
# 最大历史记录数量
max_history_size = 100

# 检查点管理器配置
[workflow.checkpoint_manager]
# 每个线程最大检查点数量
max_checkpoints_per_thread = 10
# 全局最大检查点数量
max_total_checkpoints = 1000
# 检查点过期时间（小时）
checkpoint_expiration_hours = 24

# 表达式评估器配置
[workflow.expression_evaluator]
# 是否启用表达式缓存
enable_cache = true
# 最大缓存表达式数量
max_cache_size = 1000
# 表达式评估超时时间（毫秒）
evaluation_timeout = 5000

# 路由器配置
[workflow.router]
# 是否记录路由历史
record_routing_history = true
# 最大路由历史记录数量
max_routing_history = 100
# 是否使用默认边
use_default_edge = true